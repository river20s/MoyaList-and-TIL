# 가십 프로토콜(gossip protocol)


보통 분산 시스템에서는 **두 대 이상의 서버가 똑같이 서버 A의 장애를 보고해야 해당 서버에 실제로 장애가 발생했다고 간주한다.** 서버 장애를 감지하기 위해 가장 쉬운 방법은 모든 노드 사이에 멀티캐스팅 채널을 구축하는 것이지만, 서버가 많아지면 비효율적이게 된다. 이럴 때는 가십 프로토콜(gossip protocol) 같은 분산형 장애 감지(decentralized failure detection) 솔루션을 채택하는 것이 낫다. 

### 가십 프로토콜

- 각 노드는 멤버십 목록(membership list)을 유지한다. 멤버십 목록은 각 멤버 ID와 그 박동 카운터(heartbeat counter) 쌍의 목록이다.
- 각 노드는 주기적으로 자신의 박동 카운터를 증가시킨다.
- 각 노드는 무작위로 선정된 노드들에게 주기적으로 자기 박동 카운터 목록을 보낸다.
- 박동 카운터 목록을 받은 노드는 멤버십 목록을 최신 값으로 갱신한다.
- 어떤 멤버의 박동 카운터 값이 지정된 시간 동안 갱신되지 않으면 해당 멤버는 장애(offline) 상태로 간주한다.

**예시**

![가십 프로토콜 drawio](https://github.com/user-attachments/assets/6237eb30-ca33-48a9-8e8b-7b56e5e3bb52)

![image](https://github.com/user-attachments/assets/fce389c5-598c-4d6a-837f-0efcea120989)

- 노드 s0은 테이블과 같은 멤버십 목록을 가진 상태다.
- 노드 s0은 노드 s2(멤버 ID = 2)의 박동 카운터가 오랫동안 증가되지 않았다는 것을 발견한다.
- 노드 s0은 노드 s2를 포함하는 박동 카운터 목록을 무작위로 선택된 다른 노드에게 전달한다.
- 노드 s2의 박동 카운터가 오랫동안 증가되지 않았음을 발견한 모든 노드는 해당 노드를 장애 노드로 표시한다.



